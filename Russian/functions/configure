#!/bin/bash
dir="$(dirname "$0")"

source $dir/functions/animations
source $dir/functions/button-layout

# Preferred settings
function preferences {
    # Font Sizes
    show_info 'Установка предпочтений шрифтов...'
    gsettings set org.gnome.desktop.interface document-font-name 'Source Sans Pro 10' # This is a third-party font
    gsettings set org.gnome.desktop.interface font-name 'Source Sans Pro 10'
    gsettings set org.gnome.desktop.interface monospace-font-name 'Inconsolata 11' # This is also a third-party font
    gsettings set org.gnome.desktop.interface text-scaling-factor '1.0'
    gsettings set org.gnome.desktop.wm.preferences titlebar-font 'Source Sans Pro Bold 9'
    gsettings set org.gnome.nautilus.desktop font 'Source Sans Pro 10'
    gsettings set org.gnome.settings-daemon.plugins.xsettings antialiasing 'rgba'
    gsettings set org.gnome.settings-daemon.plugins.xsettings hinting 'slight'
    # Pantheon Settings
    show_info 'Установка предпочтений Pantheon приложений...'
    gsettings set org.pantheon.noise.settings update-folder-heirarchy false
    gsettings set org.pantheon.terminal.settings font "Inconsolata 11"
    gsettings set org.pantheon.desktop.wingpanel auto-adjust-alpha false
    gsettings set org.pantheon.desktop.wingpanel background-alpha 0.6
    # GNOME Preferences
    show_info 'Установка предпочтений GNOME приложений...'
    gsettings set org.gnome.desktop.interface automatic-mnemonics true
    gsettings set org.gnome.desktop.interface clock-format 24h
    gsettings set org.gnome.desktop.interface clock-show-date true
    gsettings set org.gnome.gedit.preferences.encodings candidate-encodings "['UTF-8', 'WINDOWS-1251', 'CURRENT', 'ISO-8859-15', 'UTF-16']"
    gsettings set org.gnome.nautilus.preferences sort-directories-first true
    gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-ac-timeout 3600
    gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-ac-type nothing
    gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-battery-timeout 1800
    gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-battery-type nothing
    gsettings set org.gnome.terminal.legacy.settings new-terminal-mode tab
    gsettings set org.gnome.rhythmbox.rhythmdb monitor-library true
    gsettings set org.gnome.rhythmbox.sources browser-views 'artists-albums'
    # Done
    show_success 'Готово.'
    whiptail --title "Завершено" --msgbox "Настройки успешно изменены." 8 78
    configure
}

# Show start-up applications
function startup {
    show_info 'Изменение отображения запуска приложений...'
    show_warning 'Требует привилегий суперпользователя'
    sudo sed -i "s/NoDisplay=true/NoDisplay=false/g" /etc/xdg/autostart/*.desktop
    # Done
    show_success 'Готово.'
    whiptail --title "Завершено" --msgbox "Настройки успешно изменены." 8 78
    configure
}

# Disable Apport
function apport {
    show_info 'Отключение диалога сообщения об ошибках...'
    show_warning 'Требуется привилегии суперпользователя'
    sudo sed -i "s/enabled=1/enabled=0/g" /etc/default/apport
    # Done
    show_success 'Готово.'
    whiptail --title "Завершено" --msgbox "Настройки успешно изменены." 8 78
    configure
}

# Fix indicator keyboard
function keyboard {
	show_info 'Исправление индикатора раскладки клавиатуры...'
    gsettings set org.gnome.desktop.input-sources sources "[('xkb', 'us'), ('xkb', 'ru')]"
	gsettings set org.gnome.desktop.input-sources xkb-options "['grp_led:scroll', 'grp:alt_shift_toggle']"
    # Done
    show_success 'Готово.'
    whiptail --title "Завершено" --msgbox "Настройки успешно изменены." 8 78
    configure
}

# Configure System
function configure {
    eval `resize`
    CONF=$(whiptail \
        --notags \
        --title "Настройка системы" \
        --menu "\nЧем бы Вы хотели заняться?" \
        --cancel-button "Назад" \
        $LINES $COLUMNS $(( $LINES - 12 )) \
        preferences 'Установить предпочтительные настройки для конкретных приложений' \
        startup     'Изменить отображения запуска приложений' \
        apport      'Отключить диалог сообщения об ошибках' \
        keyboard    'Исправить индикатор раскладки клавиатуры' \
        button-layout 'Выбрать расположение кнопок' \
        animations  'Включить/выключить анимаций' \
        3>&1 1>&2 2>&3)
     
    exitstatus=$?
    if [ $exitstatus = 0 ]; then
        clear && $CONF
    else
        clear && main
    fi
}
